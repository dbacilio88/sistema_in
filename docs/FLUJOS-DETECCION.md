# Flujos de DetecciÃ³n de Infracciones

## ğŸ“‹ Ãndice
- [VisiÃ³n General](#visiÃ³n-general)
- [Flujo Completo de DetecciÃ³n](#flujo-completo-de-detecciÃ³n)
- [Flujo de Exceso de Velocidad](#flujo-de-exceso-de-velocidad)
- [Flujo de InvasiÃ³n de Carril](#flujo-de-invasiÃ³n-de-carril)
- [Flujo de Sentido Contrario](#flujo-de-sentido-contrario)
- [Flujo de Reconocimiento de Placas](#flujo-de-reconocimiento-de-placas)
- [Flujo de ValidaciÃ³n Manual](#flujo-de-validaciÃ³n-manual)
- [Responsabilidades por Componente](#responsabilidades-por-componente)

---

## ğŸ¯ VisiÃ³n General

Este documento explica en detalle los flujos de procesamiento para la detecciÃ³n de infracciones de trÃ¡nsito, desde la captura de video hasta la notificaciÃ³n al operador.

### Componentes Involucrados

1. **CÃ¡mara EZVIZ** - Captura de video
2. **Inference Service** - DetecciÃ³n bÃ¡sica
3. **ML Service** - ValidaciÃ³n y clasificaciÃ³n
4. **Backend Django** - Persistencia y gestiÃ³n
5. **Frontend Dashboard** - VisualizaciÃ³n
6. **RabbitMQ** - ComunicaciÃ³n asÃ­ncrona
7. **MinIO** - Almacenamiento de evidencia
8. **PostgreSQL** - Base de datos

---

## ğŸ”„ Flujo Completo de DetecciÃ³n

### Diagrama de Secuencia General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CÃ¡mara  â”‚  â”‚Inference â”‚  â”‚    ML    â”‚  â”‚ RabbitMQ â”‚  â”‚  Django  â”‚  â”‚Frontend â”‚
â”‚  EZVIZ  â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚          â”‚  â”‚ Backend  â”‚  â”‚Dashboardâ”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚ RTSP Streamâ”‚              â”‚              â”‚              â”‚             â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚ 1. Captura frame            â”‚              â”‚             â”‚
     â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚         â”‚    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚ 2. YOLOv8 detection         â”‚              â”‚             â”‚
     â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚ 3. Tracking (DeepSORT)      â”‚              â”‚             â”‚
     â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚ 4. OCR placasâ”‚              â”‚              â”‚             â”‚
     â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚ 5. AnÃ¡lisis velocidad       â”‚              â”‚             â”‚
     â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚ 6. vehicles.tracked         â”‚              â”‚             â”‚
     â”‚            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚ 7. ViolationDetector        â”‚             â”‚
     â”‚            â”‚              â”‚    detect_violations()      â”‚             â”‚
     â”‚            â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚         â”‚    â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚ 8. Clasificar severidad     â”‚             â”‚
     â”‚            â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚ 9. Captura evidencia        â”‚             â”‚
     â”‚            â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚       â”‚     â”‚
     â”‚            â”‚              â”‚ 10. Upload MinIO           â”‚       â”‚     â”‚
     â”‚            â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚ 11. infractions.detected    â”‚             â”‚
     â”‚            â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚ 12. Consume evento        â”‚
     â”‚            â”‚              â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚ 13. Guarda DBâ”‚             â”‚
     â”‚            â”‚              â”‚              â”‚    (PostgreSQL)           â”‚
     â”‚            â”‚              â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚          â”‚   â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚ 14. Consulta SUNARP       â”‚
     â”‚            â”‚              â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚ 15. Crea notificaciÃ³n     â”‚
     â”‚            â”‚              â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚          â”‚   â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚ 16. WebSocket notif       â”‚
     â”‚            â”‚              â”‚              â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚             â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚ 17. Muestra alerta
     â”‚            â”‚              â”‚              â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚            â”‚              â”‚              â”‚              â”‚         â”‚   â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
```

---

## ğŸï¸ Flujo de Exceso de Velocidad

### Diagrama Detallado

```
INICIO: VehÃ­culo entra en zona de mediciÃ³n
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INFERENCE SERVICE                            â”‚
â”‚                                              â”‚
â”‚ 1. YOLOv8 detecta vehÃ­culo                  â”‚
â”‚    - Clase: car                             â”‚
â”‚    - Confianza: 0.92                        â”‚
â”‚    - BBox: [100, 150, 300, 400]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. DeepSORT asigna track_id                 â”‚
â”‚    - track_id: 42                           â”‚
â”‚    - Mantiene seguimiento                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. VehÃ­culo cruza lÃ­nea de inicio           â”‚
â”‚    - Timestamp: t1 = 10:30:45.123          â”‚
â”‚    - PosiciÃ³n: (x1, y1)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Tracking continuo                        â”‚
â”‚    - Frames procesados: 45                  â”‚
â”‚    - Trayectoria guardada                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. VehÃ­culo cruza lÃ­nea de fin             â”‚
â”‚    - Timestamp: t2 = 10:30:47.823          â”‚
â”‚    - PosiciÃ³n: (x2, y2)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. CÃ¡lculo de velocidad                     â”‚
â”‚    - Tiempo: t2 - t1 = 2.7 segundos       â”‚
â”‚    - Distancia calibrada: 71.5 metros      â”‚
â”‚    - Velocidad = (71.5 / 2.7) * 3.6       â”‚
â”‚    - Resultado: 95.3 km/h                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Comparar con lÃ­mite                      â”‚
â”‚    - LÃ­mite zona: 60 km/h                  â”‚
â”‚    - Exceso: 35.3 km/h                     â”‚
â”‚    - Â¿ViolaciÃ³n? SÃ âœ“                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ML SERVICE - ViolationDetector              â”‚
â”‚                                              â”‚
â”‚ 8. detect_speed_violations()                â”‚
â”‚    - Recibe SpeedViolation                  â”‚
â”‚    - Verifica cooldown (no hay)            â”‚
â”‚    - Encuentra vehÃ­culo track_id: 42       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. Clasificar severidad                     â”‚
â”‚    - Exceso: 35.3 km/h                     â”‚
â”‚    - 20 < 35.3 < 40                        â”‚
â”‚    - Severidad: MODERATE                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. OCR de placa                            â”‚
â”‚     - Extrae ROI de placa                   â”‚
â”‚     - EasyOCR: "ABC-123"                   â”‚
â”‚     - Confianza: 0.87                      â”‚
â”‚     - ValidaciÃ³n formato: OK               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. Captura de evidencia                    â”‚
â”‚     - Snapshot frame completo               â”‚
â”‚     - Crop del vehÃ­culo                     â”‚
â”‚     - Crop de la placa                      â”‚
â”‚     - Video 10s (5s antes + 5s despuÃ©s)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 12. Almacenamiento en MinIO                â”‚
â”‚     - Snapshot: traffic-snapshots/...jpg    â”‚
â”‚     - Video: traffic-videos/...mp4         â”‚
â”‚     - URLs pÃºblicas generadas              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 13. Crear TrafficViolation                 â”‚
â”‚     violation = TrafficViolation(          â”‚
â”‚       violation_type: SPEED_VIOLATION,     â”‚
â”‚       severity: MODERATE,                   â”‚
â”‚       license_plate: "ABC-123",            â”‚
â”‚       detected_speed: 95.3,                â”‚
â”‚       speed_limit: 60,                     â”‚
â”‚       snapshot_url: "...",                 â”‚
â”‚       video_url: "..."                     â”‚
â”‚     )                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14. Publicar a RabbitMQ                     â”‚
â”‚     Queue: infractions.detected             â”‚
â”‚     Message: {                              â”‚
â”‚       event_type: "infraction_detected",   â”‚
â”‚       infraction_type: "speed",            â”‚
â”‚       severity: "moderate",                â”‚
â”‚       ...                                   â”‚
â”‚     }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND DJANGO                              â”‚
â”‚                                              â”‚
â”‚ 15. Consumer recibe mensaje                 â”‚
â”‚     - Parsea JSON                           â”‚
â”‚     - Valida estructura                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 16. Buscar/Crear Vehicle                    â”‚
â”‚     - Busca por license_plate: "ABC-123"   â”‚
â”‚     - Si no existe, consulta SUNARP        â”‚
â”‚     - Crea/actualiza registro               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 17. Crear Infraction en DB                  â”‚
â”‚     infraction = Infraction.objects.create( â”‚
â”‚       infraction_code: "INF-2025-001234",  â”‚
â”‚       infraction_type: "speed",            â”‚
â”‚       severity: "moderate",                â”‚
â”‚       device: device_obj,                   â”‚
â”‚       zone: zone_obj,                       â”‚
â”‚       vehicle: vehicle_obj,                 â”‚
â”‚       license_plate_detected: "ABC-123",   â”‚
â”‚       detected_speed: 95.3,                â”‚
â”‚       speed_limit: 60,                     â”‚
â”‚       status: "pending",                    â”‚
â”‚       ...                                   â”‚
â”‚     )                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 18. Crear Notification                      â”‚
â”‚     - Para usuarios con permiso            â”‚
â”‚     - Tipo: "infraction"                    â”‚
â”‚     - TÃ­tulo: "Nueva infracciÃ³n moderada"  â”‚
â”‚     - Link: /infractions/{id}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 19. Enviar WebSocket                        â”‚
â”‚     - Canal: notifications                  â”‚
â”‚     - Mensaje: notificaciÃ³n + infracciÃ³n   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND DASHBOARD                          â”‚
â”‚                                              â”‚
â”‚ 20. Recibe notificaciÃ³n vÃ­a WebSocket      â”‚
â”‚     - Toast notification                    â”‚
â”‚     - Sonido de alerta                      â”‚
â”‚     - Actualiza contador                    â”‚
â”‚     - Agrega a tabla de infracciones       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
           FIN: Operador puede validar
```

### Tiempo Total Estimado
- DetecciÃ³n + Tracking: ~50 ms
- OCR: ~150 ms
- Captura evidencia: ~100 ms
- Upload MinIO: ~200 ms
- RabbitMQ + Django: ~100 ms
- **TOTAL: ~600 ms (0.6 segundos)**

---

## ğŸ›£ï¸ Flujo de InvasiÃ³n de Carril

### Diagrama

```
INICIO: VehÃ­culo detectado en frame
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. DefiniciÃ³n de carriles                   â”‚
â”‚    - Lane 1: lÃ­neas [(x1,y1), (x2,y2)]     â”‚
â”‚    - Lane 2: lÃ­neas [(x3,y3), (x4,y4)]     â”‚
â”‚    - DirecciÃ³n permitida: Lane 1           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. YOLOv8 + Tracking                        â”‚
â”‚    - VehÃ­culo track_id: 42                  â”‚
â”‚    - BBox: [150, 200, 350, 450]            â”‚
â”‚    - Centro: (250, 325)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ML Service - LaneDetector                â”‚
â”‚    detect_lane_violations()                 â”‚
â”‚                                              â”‚
â”‚    - Calcula posiciÃ³n relativa a lÃ­neas    â”‚
â”‚    - Determina carril actual               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Verificar posiciÃ³n                       â”‚
â”‚    - Carril actual: Lane 2                  â”‚
â”‚    - Carril permitido: Lane 1              â”‚
â”‚    - Â¿En carril correcto? NO âœ—             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Calcular invasiÃ³n                        â”‚
â”‚    - Porcentaje de BBox en carril incorrectoâ”‚
â”‚    - Resultado: 75% invasiÃ³n               â”‚
â”‚    - Threshold: 30%                         â”‚
â”‚    - Â¿ViolaciÃ³n? SÃ âœ“ (75 > 30)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Verificar persistencia                   â”‚
â”‚    - Frames en carril incorrecto: 15       â”‚
â”‚    - MÃ­nimo requerido: 10                   â”‚
â”‚    - Â¿Persistente? SÃ âœ“                    â”‚
â”‚    - (No fue solo un cambio de carril)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Clasificar severidad                     â”‚
â”‚    - 75% invasiÃ³n                           â”‚
â”‚    - 50% < 75% < 80%                       â”‚
â”‚    - Severidad: SEVERE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. ViolationDetector crea infracciÃ³n       â”‚
â”‚    - Tipo: LANE_VIOLATION                   â”‚
â”‚    - Severidad: SEVERE                      â”‚
â”‚    - Captura evidencia                      â”‚
â”‚    - Publica a RabbitMQ                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
          [ContinÃºa flujo estÃ¡ndar]
```

---

## â¬…ï¸ Flujo de Sentido Contrario

### Diagrama

```
INICIO: VehÃ­culo trackeado con trayectoria
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Definir direcciÃ³n permitida              â”‚
â”‚    - Vector direcciÃ³n: (1, 0) â†’ Derecha    â”‚
â”‚    - Ãngulo permitido: 0Â° Â± 45Â°            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Analizar trayectoria del vehÃ­culo       â”‚
â”‚    - Puntos: [(x1,y1), (x2,y2), ..., (xn,yn)]â”‚
â”‚    - Frames trackeados: 30                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Calcular vector de movimiento           â”‚
â”‚    - Punto inicial: (x1, y1) = (500, 300) â”‚
â”‚    - Punto final: (xn, yn) = (200, 310)   â”‚
â”‚    - Vector: (-300, 10)                    â”‚
â”‚    - Normalizado: (-0.999, 0.033)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Calcular Ã¡ngulo con direcciÃ³n permitida â”‚
â”‚    - Permitida: (1, 0)                      â”‚
â”‚    - Actual: (-0.999, 0.033)               â”‚
â”‚    - Producto punto: -0.999                â”‚
â”‚    - Ãngulo: arccos(-0.999) â‰ˆ 177Â°        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Verificar sentido contrario              â”‚
â”‚    - Ãngulo: 177Â°                           â”‚
â”‚    - Threshold: 135Â°                        â”‚
â”‚    - Â¿Sentido contrario? SÃ âœ“ (177 > 135) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Verificar persistencia                   â”‚
â”‚    - Frames en sentido contrario: 30       â”‚
â”‚    - MÃ­nimo: 20                             â”‚
â”‚    - Distancia recorrida: 300 px           â”‚
â”‚    - Â¿Es giro en U? NO âœ—                   â”‚
â”‚    - Â¿ViolaciÃ³n confirmada? SÃ âœ“           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Crear infracciÃ³n CRÃTICA                 â”‚
â”‚    - Tipo: WRONG_WAY                        â”‚
â”‚    - Severidad: CRITICAL (siempre)         â”‚
â”‚    - Alerta inmediata a operadores         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
          [ContinÃºa flujo estÃ¡ndar]
```

---

## ğŸ”¤ Flujo de Reconocimiento de Placas

### Diagrama

```
INICIO: VehÃ­culo detectado
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. YOLOv8 detecta vehÃ­culo                  â”‚
â”‚    - BBox vehÃ­culo: [100, 150, 300, 400]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Buscar regiÃ³n de placa                   â”‚
â”‚    - ROI tÃ­pico: tercio inferior vehÃ­culo  â”‚
â”‚    - BBox placa: [150, 350, 250, 380]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ExtracciÃ³n de ROI                        â”‚
â”‚    - Crop imagen: plate_img                 â”‚
â”‚    - TamaÃ±o: 100x30 px                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Preprocesamiento                         â”‚
â”‚    a) Escala de grises                      â”‚
â”‚    b) Ajuste de contraste (CLAHE)          â”‚
â”‚    c) BinarizaciÃ³n (Otsu)                   â”‚
â”‚    d) ReducciÃ³n de ruido (Gaussian blur)   â”‚
â”‚    e) Resize Ã³ptimo para OCR               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. OCR con EasyOCR                          â”‚
â”‚    - Input: plate_img preprocesada          â”‚
â”‚    - Output raw: "A8C-1Z3"                 â”‚
â”‚    - Confianza: 0.82                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Post-procesamiento                       â”‚
â”‚    a) Correcciones:                         â”‚
â”‚       - "8" â†’ "B" (contexto: letra)        â”‚
â”‚       - "Z" â†’ "2" (contexto: nÃºmero)       â”‚
â”‚    b) Resultado: "ABC-123"                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. ValidaciÃ³n de formato                    â”‚
â”‚    - Regex PerÃº: ^[A-Z]{3}-\d{3,4}$        â”‚
â”‚    - "ABC-123" âœ“ coincide                  â”‚
â”‚    - Â¿Formato vÃ¡lido? SÃ âœ“                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Verificar confianza                      â”‚
â”‚    - Confianza post-correcciÃ³n: 0.87       â”‚
â”‚    - Threshold: 0.60                        â”‚
â”‚    - Â¿Aceptada? SÃ âœ“                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. Guardar snapshot de placa                â”‚
â”‚    - Crop original + anotaciones            â”‚
â”‚    - Upload a MinIO                         â”‚
â”‚    - URL: traffic-snapshots/plates/...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. Publicar evento                         â”‚
â”‚     Queue: plates.recognized                â”‚
â”‚     Message: {                              â”‚
â”‚       license_plate: "ABC-123",            â”‚
â”‚       confidence: 0.87,                    â”‚
â”‚       track_id: 42,                        â”‚
â”‚       snapshot_url: "..."                  â”‚
â”‚     }                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 11. Backend Django consulta SUNARP          â”‚
â”‚     - Busca en cache (Redis)               â”‚
â”‚     - Si no hay cache, API SUNARP          â”‚
â”‚     - Guarda/actualiza Vehicle             â”‚
â”‚     - Cache por 24 horas                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
           FIN: Placa reconocida y validada
```

### Casos Especiales

#### A. **Placa no detectada**
```
Si no se detecta ROI de placa:
  â†’ Intentar en siguientes frames (hasta 10)
  â†’ Si falla todo: infracciÃ³n sin placa
  â†’ Marcar para revisiÃ³n manual
```

#### B. **Confianza baja**
```
Si confianza < 0.60:
  â†’ Intentar en mejor frame (mÃ¡s cercano)
  â†’ Aplicar preprocesamiento adicional
  â†’ Si persiste: marcar para OCR manual
```

#### C. **Formato invÃ¡lido**
```
Si no coincide regex:
  â†’ Aplicar correcciones heurÃ­sticas adicionales
  â†’ Si persiste: guardar raw text
  â†’ Marcar para revisiÃ³n manual
```

---

## âœ… Flujo de ValidaciÃ³n Manual

### Diagrama

```
INICIO: Operador revisa infracciÃ³n pendiente
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND DASHBOARD                          â”‚
â”‚                                              â”‚
â”‚ 1. Operador accede a /infractions          â”‚
â”‚    - Ve lista de pendientes                 â”‚
â”‚    - Filtro: status=pending                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Click en infracciÃ³n especÃ­fica           â”‚
â”‚    - URL: /infractions/INF-2025-001234     â”‚
â”‚    - Carga detalles completos              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Frontend muestra evidencia               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ [Snapshot del vehÃ­culo]             â”‚ â”‚
â”‚    â”‚ [Video 10s]                         â”‚ â”‚
â”‚    â”‚                                      â”‚ â”‚
â”‚    â”‚ Tipo: Exceso de velocidad           â”‚ â”‚
â”‚    â”‚ Placa: ABC-123                      â”‚ â”‚
â”‚    â”‚ Velocidad: 95.3 km/h (lÃ­mite: 60)  â”‚ â”‚
â”‚    â”‚ Severidad: Moderada                 â”‚ â”‚
â”‚    â”‚ Fecha: 2025-11-02 10:30:45         â”‚ â”‚
â”‚    â”‚ CÃ¡mara: CAM001 - Av. Arequipa      â”‚ â”‚
â”‚    â”‚                                      â”‚ â”‚
â”‚    â”‚ Datos del vehÃ­culo (SUNARP):        â”‚ â”‚
â”‚    â”‚ - Propietario: Juan PÃ©rez           â”‚ â”‚
â”‚    â”‚ - DNI: 12345678                     â”‚ â”‚
â”‚    â”‚ - DirecciÃ³n: ...                    â”‚ â”‚
â”‚    â”‚                                      â”‚ â”‚
â”‚    â”‚ [BotÃ³n: Validar] [BotÃ³n: Rechazar] â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
          Operador revisa evidencia
               â”‚
               â”œâ”€â”€â”€ Â¿Es vÃ¡lida?
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚
      SÃ              NO
       â”‚               â”‚
       â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VALIDAR     â”‚  â”‚ RECHAZAR        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Operador completa formulario             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ [VALIDAR]                           â”‚  â”‚
â”‚    â”‚                                      â”‚  â”‚
â”‚    â”‚ Notas de revisiÃ³n:                  â”‚  â”‚
â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚    â”‚ â”‚ InfracciÃ³n vÃ¡lida. Evidencia   â”‚ â”‚  â”‚
â”‚    â”‚ â”‚ clara de exceso de velocidad.  â”‚ â”‚  â”‚
â”‚    â”‚ â”‚ Placa legible.                 â”‚ â”‚  â”‚
â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚    â”‚                                      â”‚  â”‚
â”‚    â”‚ Monto de multa: S/ 336.00          â”‚  â”‚
â”‚    â”‚ Fecha de vencimiento: 2025-11-17   â”‚  â”‚
â”‚    â”‚                                      â”‚  â”‚
â”‚    â”‚        [Confirmar ValidaciÃ³n]       â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                              â”‚
â”‚    [RECHAZAR]                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ Motivo de rechazo:                  â”‚  â”‚
â”‚    â”‚ ( ) Falso positivo                  â”‚  â”‚
â”‚    â”‚ (â€¢) Placa mal reconocida            â”‚  â”‚
â”‚    â”‚ ( ) Error de calibraciÃ³n            â”‚  â”‚
â”‚    â”‚ ( ) Otro                            â”‚  â”‚
â”‚    â”‚                                      â”‚  â”‚
â”‚    â”‚ Comentarios:                        â”‚  â”‚
â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚    â”‚ â”‚ La placa detectada no coincide â”‚ â”‚  â”‚
â”‚    â”‚ â”‚ con el vehÃ­culo en el video.   â”‚ â”‚  â”‚
â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚    â”‚                                      â”‚  â”‚
â”‚    â”‚         [Confirmar Rechazo]         â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Frontend envÃ­a a Django                  â”‚
â”‚    POST /api/infractions/{id}/validate/     â”‚
â”‚    {                                         â”‚
â”‚      "review_notes": "...",                 â”‚
â”‚      "fine_amount": 336.00,                 â”‚
â”‚      "fine_due_date": "2025-11-17"         â”‚
â”‚    }                                         â”‚
â”‚                                              â”‚
â”‚    O                                         â”‚
â”‚                                              â”‚
â”‚    POST /api/infractions/{id}/reject/       â”‚
â”‚    {                                         â”‚
â”‚      "review_notes": "...",                 â”‚
â”‚      "reject_reason": "wrong_plate"        â”‚
â”‚    }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BACKEND DJANGO                              â”‚
â”‚                                              â”‚
â”‚ 6. Actualiza Infraction                     â”‚
â”‚    [VALIDADA]                                â”‚
â”‚    - status: "pending" â†’ "validated"       â”‚
â”‚    - reviewed_by: user_id                   â”‚
â”‚    - reviewed_at: now()                     â”‚
â”‚    - review_notes: "..."                    â”‚
â”‚    - fine_amount: 336.00                    â”‚
â”‚    - fine_due_date: "2025-11-17"           â”‚
â”‚                                              â”‚
â”‚    [RECHAZADA]                               â”‚
â”‚    - status: "pending" â†’ "rejected"        â”‚
â”‚    - reviewed_by: user_id                   â”‚
â”‚    - reviewed_at: now()                     â”‚
â”‚    - review_notes: "..."                    â”‚
â”‚    - false_positive: True                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. [VALIDADA] Generar notificaciÃ³n multa   â”‚
â”‚    - Crear PDF con detalles                 â”‚
â”‚    - Enviar a sistema de notificaciones    â”‚
â”‚    - (IntegraciÃ³n futura: correo/SMS)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. [RECHAZADA] Actualizar estadÃ­sticas      â”‚
â”‚    - Incrementar contador falsos positivos â”‚
â”‚    - Analizar patrÃ³n para mejorar ML       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. WebSocket notifica a todos los operadoresâ”‚
â”‚    - "InfracciÃ³n INF-2025-001234 validada" â”‚
â”‚    - Actualiza counters en dashboard       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
           FIN: InfracciÃ³n procesada
```

---

## ğŸ¯ Responsabilidades por Componente

### Matriz de Responsabilidades

| Componente | Detecta | Trackea | OCR | Calcula Vel. | Valida | Clasifica | Persiste | Notifica |
|------------|---------|---------|-----|--------------|--------|-----------|----------|----------|
| **CÃ¡mara EZVIZ** | - | - | - | - | - | - | - | - |
| **Inference Service** | âœ… BÃ¡sico | âœ… | âœ… BÃ¡sico | âœ… BÃ¡sico | - | - | - | - |
| **ML Service** | - | - | âœ… Avanzado | âœ… Avanzado | âœ… | âœ… | - | - |
| **Backend Django** | - | - | - | - | âœ… Manual | - | âœ… | âœ… |
| **Frontend Dashboard** | - | - | - | - | Interface | - | - | Muestra |

### Detalle por Fase

#### **Fase 1: Captura (CÃ¡mara â†’ Inference)**
- CÃ¡mara: Stream RTSP
- Inference: Captura frames

#### **Fase 2: DetecciÃ³n Inicial (Inference)**
- YOLOv8: Detecta vehÃ­culos
- DeepSORT: Trackea vehÃ­culos
- OCR bÃ¡sico: Intenta leer placa
- CÃ¡lculo bÃ¡sico: Estima velocidad

#### **Fase 3: ValidaciÃ³n y ClasificaciÃ³n (ML Service)** ğŸ†
- **ViolationDetector:** RESPONSABLE PRINCIPAL
  - Valida si es infracciÃ³n real
  - Clasifica tipo de infracciÃ³n
  - Determina severidad
  - Filtra falsos positivos
  - Recopila evidencia

#### **Fase 4: Persistencia (Backend Django)**
- Guarda en PostgreSQL
- Enriquece con SUNARP
- Crea notificaciones

#### **Fase 5: RevisiÃ³n (Operador + Django)**
- Operador valida manualmente
- Django actualiza estado
- Genera multa

---

## ğŸ“Š Resumen

### ğŸ† Componente Principal de DetecciÃ³n

**ML Service - ViolationDetector**

**UbicaciÃ³n:** `ml-service/src/violations/violation_detector.py`

**Responsabilidades:**
1. âœ… Detectar infracciones (todos los tipos)
2. âœ… Clasificar severidad
3. âœ… Validar detecciones
4. âœ… Filtrar falsos positivos
5. âœ… Capturar evidencia
6. âœ… Publicar eventos

### Flujo Simplificado

```
CÃ¡mara â†’ Inference (detecciÃ³n bÃ¡sica) â†’ ML Service (validaciÃ³n) â†’ Django (persistencia) â†’ Frontend (visualizaciÃ³n)
```

### Tiempos de Procesamiento

| Etapa | Tiempo |
|-------|--------|
| Captura + DetecciÃ³n | ~50 ms |
| Tracking | ~10 ms |
| OCR | ~150 ms |
| ValidaciÃ³n ML | ~20 ms |
| Evidencia + Upload | ~300 ms |
| Persistencia Django | ~100 ms |
| **TOTAL** | **~630 ms** |

---

**Documentos relacionados:**
- [ARQUITECTURA.md](./ARQUITECTURA.md) - VisiÃ³n general del sistema
- [ML-SERVICE.md](./ML-SERVICE.md) - Detalle del ViolationDetector
- [INFERENCE-SERVICE.md](./INFERENCE-SERVICE.md) - Procesamiento de video
- [BACKEND-DJANGO.md](./BACKEND-DJANGO.md) - API y persistencia

---

**Ãšltima actualizaciÃ³n:** Noviembre 2025
